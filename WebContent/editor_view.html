<!DOCTYPE html>
<html>

<head>
    <title>skarf.js - Track Three.js Scene</title>
    <meta charset="UTF-8" />

    <link href='http://fonts.googleapis.com/css?family=Fauna+One' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/style.css">

    <!--load helper libraries-->
    <script type="text/javascript" src="js/jquery/jquery-2.0.2.min.js"></script>

    <!--load 3D libraries-->
    <script type="text/javascript" src="js/threejs/three.min.js"></script>

    <!--load AR libraries-->
    <script type="text/javascript" src="js/js-aruco/svd.js"></script>
    <script type="text/javascript" src="js/js-aruco/posit2.js"></script>
    <script type="text/javascript" src="js/js-aruco/cv.js"></script>
    <script type="text/javascript" src="js/js-aruco/aruco.js"></script>

	<!--load blockly/js-aruco manager library-->
	<script type="text/javascript" src="js/BAM.js"></script>
	
    <script>
    var image, video, bam;
    var step = 0.0;
    
    function onLoad(){
      video = document.getElementById("video");
      image = document.getElementById("image");
      
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
      if (navigator.getUserMedia){
        init();
      }
    };
    
    function init(){
      navigator.getUserMedia({video:true}, 
        function (stream){
          if (window.webkitURL) {
            video.src = window.webkitURL.createObjectURL(stream);
          } else if (video.mozSrcObject !== undefined) {
            video.mozSrcObject = stream;
          } else {
            video.src = stream;
          }
        },
        function(error){
        }
      );

      var camera = new THREE.PerspectiveCamera(40, canvas.width / canvas.height, 1, 1000);
      var directionalLight = new THREE.DirectionalLight(0xffffff);
      directionalLight.position.set(1, 1, 1).normalize();

      bam = new BAM(image,"canvas","container",camera);
      bam.sceneAdd(directionalLight);
      var  cube = new THREE.Mesh( new THREE.CubeGeometry( 200, 200, 200 ), new THREE.MeshNormalMaterial() );
      bam.sceneAdd( cube );
      window.requestAnimationFrame(loop);
    };
    
    window.onload = onLoad;
    
    function loop(){
      bam.tick();
      requestAnimationFrame(loop);
    }

    window.run = function run(generatedCode){
        bam.evaluate(generatedCode);
   }
    </script>
</head>

<body>
	<video id="video" width=640 height=480 autoplay="true" style="display:none;"></video>
	<img id="image" width=640 height=480 src="test.png" style="display:none;"></img>
	<div style="width: 100%;">
    <div style="width: 650px; margin-left:auto; margin-right:auto;">
    <div class="invisible">
    	<canvas id="canvas" style="width: 640px; height: 480px; float: left; border: solid 1px black;"></canvas></div>
      <div id="container" style="width: 640px; height: 480px; float: left; border: solid 1px black; background: green;"></div>
      <!--div style="clear: both;"></div-->
    </div>
  </div>
</body>

</html>
